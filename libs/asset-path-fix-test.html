<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asset Path Fix - Test & Examples</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
      line-height: 1.6;
    }
    h1 {
      color: #1e293b;
      border-bottom: 2px solid #22d3ee;
      padding-bottom: 0.5rem;
    }
    .test-case {
      background: #f8fafc;
      border-left: 4px solid #22d3ee;
      padding: 1rem;
      margin: 1rem 0;
    }
    .test-case h3 {
      margin-top: 0;
      color: #334155;
    }
    code {
      background: #e2e8f0;
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
    .result {
      color: #059669;
      font-weight: 600;
    }
    .pass {
      color: #059669;
    }
    .fail {
      color: #dc2626;
    }
  </style>
</head>
<body>
  <h1>Asset Path Fix Helper - Test & Examples</h1>
  
  <p>
    This page demonstrates the <code>normalizeAssetPath()</code> function which fixes 
    asset URL issues on GitHub Pages and other hosting environments.
  </p>

  <h2>Problem Statement</h2>
  <p>
    When a site is deployed on GitHub Pages under a subpath (e.g., 
    <code>https://username.github.io/repo-name/</code>), absolute paths like 
    <code>/models/heart.glb</code> incorrectly resolve to the domain root 
    (<code>https://username.github.io/models/heart.glb</code>) instead of the repo 
    root. Additionally, concatenating paths without normalization can create double 
    slashes (<code>//heart.glb</code>).
  </p>

  <h2>Solution</h2>
  <p>
    Use relative paths (without leading slash) and the <code>normalizeAssetPath()</code> 
    helper to safely join path segments.
  </p>

  <h2>Test Cases</h2>
  <div id="test-results"></div>

  <script src="asset-path-fix.js"></script>
  <script>
    // Test cases for normalizeAssetPath
    const tests = [
      {
        name: "Simple relative path",
        base: '',
        path: 'models/heart.glb',
        expected: 'models/heart.glb'
      },
      {
        name: "Base with path",
        base: 'assets',
        path: 'models/heart.glb',
        expected: 'assets/models/heart.glb'
      },
      {
        name: "Base with trailing slash",
        base: 'assets/',
        path: 'models/heart.glb',
        expected: 'assets/models/heart.glb'
      },
      {
        name: "Path with leading slash",
        base: 'assets/',
        path: '/models/heart.glb',
        expected: 'assets/models/heart.glb'
      },
      {
        name: "Remove leading slash from path when no base",
        base: '',
        path: '/models/heart.glb',
        expected: 'models/heart.glb'
      },
      {
        name: "Absolute URL in path",
        base: 'assets',
        path: 'https://example.com/file.glb',
        expected: 'https://example.com/file.glb'
      },
      {
        name: "Absolute URL in base",
        base: 'https://example.com/file.glb',
        path: '',
        expected: 'https://example.com/file.glb'
      },
      {
        name: "Multiple trailing slashes in base",
        base: 'assets///',
        path: 'models/heart.glb',
        expected: 'assets/models/heart.glb'
      },
      {
        name: "Multiple leading slashes in path",
        base: 'assets',
        path: '///models/heart.glb',
        expected: 'assets/models/heart.glb'
      },
      {
        name: "Empty strings",
        base: '',
        path: '',
        expected: ''
      }
    ];

    // Run tests
    const resultsDiv = document.getElementById('test-results');
    let passed = 0;
    let failed = 0;

    tests.forEach((test, index) => {
      const result = normalizeAssetPath(test.base, test.path);
      const success = result === test.expected;
      
      if (success) passed++;
      else failed++;

      const testDiv = document.createElement('div');
      testDiv.className = 'test-case';
      testDiv.innerHTML = `
        <h3>Test ${index + 1}: ${test.name} <span class="${success ? 'pass' : 'fail'}">${success ? '✓ PASS' : '✗ FAIL'}</span></h3>
        <p><strong>Input:</strong> <code>normalizeAssetPath('${test.base}', '${test.path}')</code></p>
        <p><strong>Expected:</strong> <code class="result">${test.expected}</code></p>
        <p><strong>Actual:</strong> <code class="result ${success ? 'pass' : 'fail'}">${result}</code></p>
      `;
      resultsDiv.appendChild(testDiv);
    });

    // Summary
    const summaryDiv = document.createElement('div');
    summaryDiv.style.padding = '1rem';
    summaryDiv.style.background = passed === tests.length ? '#d1fae5' : '#fee2e2';
    summaryDiv.style.borderRadius = '8px';
    summaryDiv.style.marginTop = '2rem';
    summaryDiv.innerHTML = `
      <h2>Test Summary</h2>
      <p>
        <strong class="pass">Passed: ${passed}</strong> | 
        <strong class="fail">Failed: ${failed}</strong> | 
        <strong>Total: ${tests.length}</strong>
      </p>
    `;
    resultsDiv.appendChild(summaryDiv);

    console.log(`Test Results: ${passed}/${tests.length} passed`);
  </script>
</body>
</html>
